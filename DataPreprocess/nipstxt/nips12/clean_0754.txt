abstract present hidden markov model hmm inferring hidden psychological state neural activity single trial fmri activation experiments blocked task paradigms inference based bayesian methodology using combination analytical variety markov chain monte carlo mcmc sampling techniques advantage method detection short time learning effects repeated trials possible since inference based single trial experiments introduction functional magnetic resonance imaging fmri non invasive technique enables indirect measures neuronal activity working human brain common fmri technique based image contrast induced temporal shifts relative concentration oxyhemoglobin deoxyhemoglobin bold contrast since neuronal activation leads increased blood flow called hemodynamic response measured fmri signal reflects neuronal activity hence analyzing bold signal two unknown factors consider task dependent neuronal activation hemodynamic response bandettini et al analyzed correlation binary reference function representing stimulus task sequence bold signal following also make reference binary representation task paradigm lange zeger discuss parameterized hemodynamic response adapted least squares procedure multivariate strategies pursued worsley et al hansen et al several explorative strategies proposed finding spatio temporal activation patterns without explicit reference activation paradigm mckeown et al used independent component analysis found several types activations including components transient task related response responses could simply accounted paradigm model presented paper draws experimental observation basic coupling net neural activity hemodynamic response roughly linear relation neuronal response stimulus task parameters often nonlinear dale represent neuronal activity integrated voxel sampling time interval binary signal represent hemodynamic response linear filter unknown form temporal extent bayesian modelling fmri time series bayesian model fmri time series let st hidden sequence binary state variables st representing state single voxel time time variable indexes sequence fmri scans hence st binary representation neural state hidden sequence governed symmetric first order hidden markov model hmm transition probability oz st jlst expect activation mimic blocked structure experimental paradigm reason restrict oz larger one half predicted signal noiseless signal given tt denotes linear convolution impulse response linear system order mr dc set linear trend typically seen fmri time series given respectively finally assumed observable given generative model zt lt iid gaussian noise variance considered therefore given stlst oz ozc zls ms ac yt zt furthermore usual kronecker delta ms step shift operator sl st linear parameters collected st xt graphical model hidden states xt st st st ms introduced make model first order analytic integration monte carlo sampling section introduce priors model parameters show inference may performed filter coefficients noise parameters may handled analytically whereas remaining parameters treated using sampling procedures combination gibbs metropolis sampling like previous section explicit reference filter order may omitted ease notation dc set linear trend given improper uniform priors filter coefficients given priors uniform interval length independently coefficient mf ihi mf otherwise assuming values associated likelihood non vanishing contributions lie inside box prior support may integrate filter coefficients via gaussian integral zlan mf zlo mf olmi exp pa hojen sorensen hansen rasmussen defined mean filter hs ih mean predicted signal hs given state filter length set interval length times standard deviation observed signal done since response filter able model signal thought need interval plus minus two standard deviations proceed integrate noise parameter using improper noninformative jeffreys prior crn oc cr get gamma integral zls mf crn mi crn dcrn zthe remaining variables cannot handled analytically treated using various forms sampling described following sections gibbs metropolis updates state sequence use flat prior states st st together first order markov property hidden states bayes rule get conditional posterior individual states st jls st oc st jlst st llst zls mf probabilities may normalized form used implement gibbs updates hidden state variables updating one variable time sweeping variables however turns significant correlations states makes difficult markov chain move around hidden state space using gibbs sampling single state updated time improve situation also perform global state updates consisting proposing move entire state sequence one step forward backward direction chosen random accepting proposed state using metropolis acceptance procedure proposed movements made using periodic boundary conditions gibbs sweep computationally involved since requires computation several matrix expressions every state variable adaptive rejection sampling transition probability likelihood transition probability derived hidden markov model slc ae tlst st st number neighboring states identical values prior transition probabilities uniform restricted larger one half since expect activation mimic blocked structure experimental paradigm readily seen slo log concave hence may use adaptive rejection sampling algorithm gilks wild sample distribution transition probability metropolis updates filter length practical applications using real fmri data typically know necessary length filter problem finding right model order difficult received lot attention let markov chain sample different filter lengths effectively integrating filter length rather trying optimize although bayesian modelling fmri time series value mf determines dimensionality parameter space need use specialized sampling methodology reversible jump mcmc green since parameters handled analytically model put flat improper prior mf propose new filter lengths using gaussian proposal centered current value standard deviation non positive proposed orders rejected choice standard deviation effects mixing rate markov chain influence stationary distribution proposed values accepted using metropolis algorithm using mfls oc yl mf posterior mean uncertainty predicted signal since flat prior conditional probability filter coefficients proportional likelihood zlo get olz mf sz ds posterior mean predicted signal readily computed average done analytically average state filter length done using monte carlo uncertainty posterior also estimated partly analytical averaging partly monte carlo fszz example synthetic data order test model first present results synthetic data set signal length generated using mf order filter hidden state sequence consisting two activation bursts indicated dotted bars figure top left example hidden sequence actually generated generarive model however still exhibits kind block structure wish able recover model run iterations sufficient generate approximately independent samples posterior figure right shows autoocovariance mf function iteration lag thought changes mf indicative correlation time overall system correlation plot hidden states figure left shows state activation onset correlates strongly second onset negatively end activation vice versa indicates metropolis updates described section may indeed effective notice also strong correlation among state variables strongly carry predicted signal figure bottom right verify model reasonably recover parameters used generate data posterior samples model variables shown figure parameters posterior density large around correct values notice original model indeterminacy simultaneous inference state sequence filter parameters indeterminacy predicted signal example signal predicted shifting state sequence backward time introducing leading zero filter coefficients however bayesian methodology breaks symmetry penalizing complex models hojen sorensen hansen rasmussen scan number scan number scan number scan number loo figure experiments synthetic data top left measured response voxel plotted consecutive scans bottom left underlying signal seen thin together posterior mean thick two std dev error bars dotted top right posterior probabilities shown grey level scan true activated instances indicated dotted bars pseudo map estimate activation sequence given crossed bars bottom right shows posterior uncertainty posterior mean two standard deviations plotted figure bottom left notice however distribution gaussian rather mixture gaussians necessarily well characterized mean variance alone figure top left distribution tt visualized using grey scale represent density simulations real fmri data discussion figure model applied two measurements voxel visual cortex fmri scans acquired every ms experimental paradigm consisted scans rest followed scans activation rest visual activation consisted flashing hz annular checkerboard pattern model readily identifies activation burst somewhat longer duration visual stimulus delayed around seconds delay part caused delay hemodynamic response results show integration procedure works spite limited data hand figure top posterior model size suggests least two competing models explain signal trial one models explains measured signal simple square wave function seems reasonable considering signal conversely figure bottom suggests signal second trial explained simple model seems reasonable long signal raise interval suggested signal bayesian modelling fmri time series hidden state variables lag figure covariance hidden states based long run model shown left notice states around front back activity bumps highly anti correlated right auto covariance filter length function lag time iterations correlation length computed sum autocovariance coefficients lag since posterior distribution filter length broad questionable whether optimization based procedure maximum likelihood estimation would able make useful inference case data limited also obvious one may use cross validation setting one might expect optimization based strategies get trapped suboptimal solutions course remains investigated conclusion presented model voxel based explorative data analysis single trial fmri signals blocked task activation studies model founded experimental observation basic coupling net neural activity hemodynamic response roughly linear preliminary investigation reported encouraging model reliably detects reasonable hidden states noisy fmri data one drawback method gibbs sampling step computational expensive improve step one could make use large class variational mean field methods known graphical models literature finally current work progress generalizing model multiple voxels including spatial correlation due spillover effects dc set trend oo mf figure posterior distributions various model parameters parameters used generate data dc set trend filter order mf hojen sorensen hansen rasmussen scan number scan number oo mf mf figure analysis two experimental trials voxel visual cortex left hand plot shows posterior inferred signal distribution superimposed measured signal dotted bar indicates experimental paradigm crossed bar indicates pseudo map estimate neural activity right posterior noise level inferred filter length displayed acknowledgments thanks egill rostrup providing fmri data work funded danish research councils computational neural network center connect thor center neuroinformatics